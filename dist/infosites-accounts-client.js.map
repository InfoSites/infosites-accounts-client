{"version":3,"file":"infosites-accounts-client.js","sources":["../src/main.js"],"sourcesContent":["import jwtDecode from 'jwt-decode'\r\n\r\nexport default function( params ) {\r\n\tvar _addAttribute = function( ele, attrName, attrValue ) {\r\n\t\ttry {\r\n\t\t\tvar attr = document.createAttribute( attrName )\r\n\t\t\tattr.nodeValue = attrValue\r\n\t\t\tele.setAttributeNode( attr )\r\n\t\t} catch( ex ) {}\r\n\t}\r\n\t\r\n\tlet iframeId = `iframe-infosites-accounts-${params.appId}`\r\n\t\t\r\n\tlet iframe = document.getElementById(iframeId)\r\n\tif (!iframe) {\r\n\t\tiframe = document.createElement ( \"IFRAME\" );\r\n\t\t_addAttribute( iframe, 'id', iframeId );\r\n\t\t_addAttribute( iframe, 'frameBorder', 0 );\r\n\t\t_addAttribute( iframe, 'style', 'position: absolute; bottom: 0; right: 0; width: 0; height: 0;' );\r\n\t\tdocument.body.appendChild( iframe );\r\n\t}\r\n\r\n\tiframe.src = `${params.url}/login/#/token?app=${params.appId}&source=${window.location.href}`\r\n\r\n\tlet exports = {}\r\n\r\n\texports.getToken = function () {\r\n\t  return new Promise((resolve, reject) => {\r\n\t\tlet listener = function (event) {\r\n\t\t  if (!event.data || typeof event.data !== 'string') return\r\n\t\t  let chunk = event.data.split('--')\r\n          if (chunk[0] === 'token') resolve(chunk[1])\r\n          if (chunk[0] === 'redirect') reject(chunk[1])\r\n          window.removeEventListener('message', listener)\r\n\t\t}\r\n\t\twindow.addEventListener('message', listener)\r\n\t\tiframe.contentWindow.postMessage('token', '*')\r\n\t  })\r\n\t}\r\n\r\n\texports.decodeUser = function (token) {\r\n\t  let decoded = jwtDecode(token)\r\n\t  return {id: decoded.sub, email: decoded.email}\r\n\t}\r\n\r\n\texports.getUser = function () {\r\n\t  return new Promise((resolve, reject) => {\r\n\t\texports.getToken().then(function (token) {\r\n\t\t  resolve(exports.decodeUser(token))\r\n\t\t}, function (err) {\r\n\t\t  reject(err)\r\n\t\t})\r\n\t  })\r\n\t}\r\n\r\n\texports.logout = function () {\r\n\t  return new Promise((resolve, reject) => {\r\n\t\tlet listener = function (event) {\r\n\t\t  resolve()\r\n\t\t  window.removeEventListener('message', listener)\r\n\t\t}\r\n\t\twindow.addEventListener('message', listener)\r\n\t\tiframe.contentWindow.postMessage('logout', '*')\r\n\t  })\r\n\t}\r\n\t\r\n\treturn exports;\r\n}\r\n"],"names":["params","_addAttribute","ele","attrName","attrValue","attr","document","createAttribute","nodeValue","setAttributeNode","ex","iframeId","appId","iframe","getElementById","createElement","body","appendChild","src","url","window","location","href","exports","getToken","Promise","resolve","reject","listener","event","data","chunk","split","removeEventListener","addEventListener","contentWindow","postMessage","decodeUser","token","decoded","jwtDecode","id","sub","email","getUser","then","err","logout"],"mappings":"2RAEe,SAAUA,OACpBC,EAAgB,SAAUC,EAAKC,EAAUC,WAEvCC,EAAOC,SAASC,gBAAiBJ,KAChCK,UAAYJ,IACbK,iBAAkBJ,GACrB,MAAOK,MAGNC,+BAAwCX,EAAOY,MAE/CC,EAASP,SAASQ,eAAeH,GAChCE,QACKP,SAASS,cAAgB,UACX,KAAMJ,KACdE,EAAQ,cAAe,KACvBA,EAAQ,QAAS,0EACvBG,KAAKC,YAAaJ,MAGrBK,IAASlB,EAAOmB,0BAAyBnB,EAAOY,iBAAgBQ,OAAOC,SAASC,SAEnFC,cAEIC,SAAW,kBACV,IAAIC,QAAQ,SAACC,EAASC,OAC1BC,EAAW,SAAXA,EAAqBC,MAClBA,EAAMC,MAA8B,iBAAfD,EAAMC,UAC5BC,EAAQF,EAAMC,KAAKE,MAAM,MACN,UAAbD,EAAM,IAAgBL,EAAQK,EAAM,IACvB,aAAbA,EAAM,IAAmBJ,EAAOI,EAAM,WACnCE,oBAAoB,UAAWL,YAEvCM,iBAAiB,UAAWN,KAC5BO,cAAcC,YAAY,QAAS,UAInCC,WAAa,SAAUC,OACzBC,EAAUC,EAAUF,UAChBG,GAAIF,EAAQG,IAAKC,MAAOJ,EAAQI,UAGlCC,QAAU,kBACT,IAAInB,QAAQ,SAACC,EAASC,KACtBH,WAAWqB,KAAK,SAAUP,KACxBf,EAAQc,WAAWC,KAC1B,SAAUQ,KACJA,UAKFC,OAAS,kBACR,IAAItB,QAAQ,SAACC,EAASC,OAC1BC,EAAW,SAAXA,EAAqBC,cAEhBI,oBAAoB,UAAWL,WAEjCM,iBAAiB,UAAWN,KAC5BO,cAAcC,YAAY,SAAU,QAIrCb"}